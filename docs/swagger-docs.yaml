openapi: 3.0.3
info:
  title: Clinica Backend API
  version: 1.0.0
servers:
  - url: http://localhost:3001
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginRequest:
      type: object
      required:
        - usr_txt_email
        - usr_txt_password
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 50
        usr_txt_password:
          type: string
          minLength: 1
          maxLength: 100
      example:
        usr_txt_email: "juan.perez@correo.com"
        usr_txt_password: "Password#123"
    LoginResponse:
      type: object
      properties:
        token:
          type: string
      example:
        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    MessageResponse:
      type: object
      properties:
        message:
          type: string
      example:
        message: "OK"
    VerifyEmailRequest:
      type: object
      required:
        - usr_txt_email
        - usr_txt_verification_code
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 50
        usr_txt_verification_code:
          type: string
          minLength: 6
          maxLength: 6
      example:
        usr_txt_email: "juan.perez@correo.com"
        usr_txt_verification_code: "123456"
    RequestPasswordResetRequest:
      type: object
      required:
        - usr_txt_email
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 50
      example:
        usr_txt_email: "juan.perez@correo.com"
    ResetPasswordRequest:
      type: object
      required:
        - usr_txt_email
        - usr_txt_verification_code
        - usr_txt_password
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 50
        usr_txt_verification_code:
          type: string
          minLength: 6
          maxLength: 6
        usr_txt_password:
          type: string
          minLength: 8
          maxLength: 100
          description: "Must include uppercase, lowercase, number, and special character."
      example:
        usr_txt_email: "juan.perez@correo.com"
        usr_txt_verification_code: "123456"
        usr_txt_password: "New#Password1"
    RegisterRequest:
      type: object
      required:
        - usr_txt_email
        - usr_txt_password
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 254
        usr_txt_password:
          type: string
          minLength: 8
          maxLength: 100
          description: "Must include uppercase, lowercase, number, and special character."
      example:
        usr_txt_email: "juan.perez@correo.com"
        usr_txt_password: "Password#123"
    CreateUserRequest:
      type: object
      required:
        - usr_txt_email
        - roles
        - usr_txt_password
        - usr_sta_state
        - usr_sta_employee_state
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 254
        roles:
          type: array
          items:
            type: string
          description: "Lista de roles: admin, recepcionista, medico, paciente"
        usr_txt_password:
          type: string
          minLength: 8
          maxLength: 100
          description: "Must include uppercase, lowercase, number, and special character."
        usr_bol_email_verified:
          type: boolean
        usr_sta_state:
          type: integer
        usr_sta_employee_state:
          type: integer
      example:
        usr_txt_email: "juan.perez@correo.com"
        roles:
          - "admin"
        usr_txt_password: "Password#123"
        usr_bol_email_verified: false
        usr_sta_state: 1
        usr_sta_employee_state: 1
    UserResponse:
      type: object
      properties:
        usr_idt_id:
          type: integer
        usr_txt_email:
          type: string
          format: email
          maxLength: 254
        usr_bol_email_verified:
          type: boolean
        roles:
          type: array
          items:
            type: string
          description: "Lista de roles: admin, recepcionista, medico, paciente"
        usr_sta_state:
          type: integer
        usr_sta_employee_state:
          type: integer
        usr_dat_created_at:
          type: string
          format: date-time
        usr_dat_updated_at:
          type: string
          format: date-time
        date_deleted_at:
          type: string
          format: date-time
          nullable: true
      example:
        usr_idt_id: 10
        usr_txt_email: "juan.perez@correo.com"
        usr_bol_email_verified: true
        roles:
          - "paciente"
        usr_sta_state: 1
        usr_sta_employee_state: 1
        usr_dat_created_at: "2026-02-02T03:00:00.000Z"
        usr_dat_updated_at: "2026-02-02T03:00:00.000Z"
        date_deleted_at: null
    UpdateUserRequest:
      type: object
      properties:
        usr_txt_email:
          type: string
          format: email
          maxLength: 254
        roles:
          type: array
          items:
            type: string
          description: "Lista de roles: admin, recepcionista, medico, paciente"
        usr_txt_password:
          type: string
          minLength: 8
          maxLength: 100
          description: "Must include uppercase, lowercase, number, and special character."
        usr_bol_email_verified:
          type: boolean
        usr_sta_state:
          type: integer
        usr_sta_employee_state:
          type: integer
      example:
        usr_txt_email: "juan.perez@correo.com"
        usr_txt_password: "New#Password1"
paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
  /auth/register:
    post:
      summary: Register user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
            example:
              usr_txt_email: "juan.perez@correo.com"
              usr_txt_password: "Password#123"
      responses:
        "201":
          description: Created. Sensitive fields (password and verification/reset fields) are omitted in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
              example:
                usr_idt_id: 10
                loc_idt_id: 1
                usr_txt_name: "Juan"
                usr_txt_lastname: "Perez"
                usr_txt_dni: "12345678"
                usr_dat_dateofbirth: "1990-01-01"
                usr_int_gender: 1
                usr_txt_celphone: "3511234567"
                usr_txt_cuit_cuil: "20345678901"
                usr_txt_email: "juan.perez@correo.com"
                usr_txt_streetname: "Calle Falsa"
                usr_txt_streetnumber: "1234"
                usr_txt_floor: "2"
                usr_txt_department: "B"
                usr_txt_postalcode: "5000"
                roles:
                  - "admin"
                usr_dat_registrationdate: "2025-01-01"
                usr_int_registerorigin: 1
                usr_txt_registeroriginhash: "web"
                usr_dat_terminationdate: null
                usr_int_image: null
                usr_txt_image_ext: null
                usr_sta_state: 1
                usr_sta_employee_state: 1
                date_deleted_at: null
        "400":
          description: Validation error
        "409":
          description: Email or DNI already exists
  /auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
            example:
              usr_txt_email: "juan.perez@correo.com"
              usr_txt_password: "Password#123"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          description: Validation error
        "401":
          description: Invalid credentials
        "403":
          description: Account not verified
  /auth/verify-email:
    post:
      summary: Verify email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyEmailRequest"
      responses:
        "200":
          description: Email verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Invalid or expired code
        "404":
          description: User not found
  /auth/request-password-reset:
    post:
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestPasswordResetRequest"
      responses:
        "200":
          description: If the email exists, a reset code is sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Validation error
  /auth/reset-password:
    post:
      summary: Reset password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Invalid or expired code
        "404":
          description: User not found
  /users:
    post:
      summary: Create user (admin/receptionist)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
            example:
              usr_txt_email: "juan.perez@correo.com"
              roles:
                - "admin"
              usr_txt_password: "Password#123"
              usr_bol_email_verified: false
              usr_sta_state: 1
              usr_sta_employee_state: 1
      responses:
        "201":
          description: Created. Sensitive fields (password and verification/reset fields) are omitted in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
              example:
                usr_idt_id: 10
                usr_txt_email: "juan.perez@correo.com"
                usr_bol_email_verified: false
                roles:
                  - "admin"
                usr_sta_state: 1
                usr_sta_employee_state: 1
                usr_dat_created_at: "2026-02-02T03:00:00.000Z"
                usr_dat_updated_at: "2026-02-02T03:00:00.000Z"
                date_deleted_at: null
        "400":
          description: Validation error
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
  /users/{id}:
    get:
      summary: Get user by id (admin/receptionist/doctor or self)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: OK. Sensitive fields (password and verification/reset fields) are omitted in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
              example:
                usr_idt_id: 10
                usr_txt_email: "juan.perez@correo.com"
                usr_bol_email_verified: true
                roles:
                  - "paciente"
                usr_sta_state: 1
                usr_sta_employee_state: 1
                usr_dat_created_at: "2026-02-02T03:00:00.000Z"
                usr_dat_updated_at: "2026-02-02T03:00:00.000Z"
                date_deleted_at: null
        "400":
          description: Invalid id
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not found
    put:
      summary: Update user (admin/receptionist)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
            example:
              usr_txt_email: "juan.perez@correo.com"
              usr_txt_password: "New#Password1"
      responses:
        "200":
          description: OK. Sensitive fields (password and verification/reset fields) are omitted in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
              example:
                usr_idt_id: 10
                usr_txt_email: "juan.perez@correo.com"
                usr_bol_email_verified: true
                roles:
                  - "paciente"
                usr_sta_state: 1
                usr_sta_employee_state: 1
                usr_dat_created_at: "2026-02-02T03:00:00.000Z"
                usr_dat_updated_at: "2026-02-02T03:00:00.000Z"
                date_deleted_at: null
        "400":
          description: Invalid id
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not found
    delete:
      summary: Soft delete user (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: No Content
        "400":
          description: Invalid id
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

